<article class="thumbnail portfolio-item">
    <div class="caption">
        <div class="portfolio-actions pull-right">
            {% if _u.id == item.user.id %}
                <a href="{{ baseurl ~ {'action':'edit_item', 'id':item.id}|url_encode }}">
                    {{ 'edit.png'|img(22, 'Edit'|get_lang) }}
                </a>
                {% if item.isVisible %}
                    <a href="{{ baseurl ~ {'action':'hide_item', 'id':item.id}|url_encode }}">
                        {{ 'visible.png'|img(22, 'Invisible'|get_lang) }}
                    </a>
                {% else %}
                    <a href="{{ baseurl ~ {'action':'show_item', 'id':item.id}|url_encode }}">
                        {{ 'invisible.png'|img(22, 'Visible'|get_lang) }}
                    </a>
                {% endif %}
                <a href="{{ baseurl ~ {'action':'delete_item', 'id':item.id}|url_encode }}" class="btn-delete">
                    {{ 'delete.png'|img(22, 'Delete'|get_lang) }}
                </a>
            {% endif %}

            <a href="{{ baseurl ~ {'action':'copy', 'copy':'item', 'id':item.id}|url_encode }}">
                {{ 'copy.png'|img(22, 'CopyToMyPortfolio'|get_lang) }}
            </a>
        </div>

        <h4 class="h3">{{ item.title }}</h4>

        <ul class="fa-ul list-inline">
            {% if _c is empty %}
                {% if item.session %}
                    <li>
                        <span class="fa-li fa fa-book" aria-hidden="true"></span>
                        {{ 'Course'|get_lang ~ ': ' ~ item.session.name ~ ' (' ~ item.course.title ~ ')' }}
                    </li>
                {% elseif not item.session and item.course %}
                    <li>
                        <span class="fa-li fa fa-book" aria-hidden="true"></span>
                        {{ 'Course'|get_lang ~ ': ' ~ item.course.title }}
                    </li>
                {% endif %}
            {% else %}
                <li>
                    <span class="fa-li fa fa-user" aria-hidden="true"></span>
                    {{ item.user.completeName }}
                </li>
            {% endif %}

            <li>
                <span class="fa-li fa fa-clock-o" aria-hidden="true"></span>
                {{ 'CreationDate'|get_lang ~ ': ' ~ item.creationDate|date_to_time_ago }}
            </li>

            {% if item.creationDate != item.updateDate %}
                <li>
                    <span class="fa-li fa fa-clock-o" aria-hidden="true"></span>
                    {{ 'UpdateDate'|get_lang ~ ': ' ~ item.updateDate|date_to_time_ago }}
                </li>
            {% endif %}

            <li>
                <span class="fa-li fa fa-comment-o" aria-hidden="true"></span>
                {{ 'XComments'|get_lang|format(item.comments.count) }}
            </li>
        </ul>

        {% if item.origin %}
            <hr>

            <blockquote>
                {{ origin.content }}
                {% if item.originType == 1 %}
                    <footer>{{ 'OriginallyPublishedAsXTitleByYUser'|get_lang|format(origin.title, origin.user.completeName) }}</footer>
                {% elseif item.originType == 2 %}
                    <footer>{{ 'OriginallyCommentedByXUserInYItem'|get_lang|format(origin.author.completeName, origin.item.title) }}</footer>
                {% endif %}
            </blockquote>
        {% endif %}

        <hr>

        <div class="clearfix">
            {{ item.content }}
        </div>
    </div>
</article>

<hr>

<h5 class="h4">{{ 'XComments'|get_lang|format(item.comments.count) }}</h5>

{{ comments }}

{{ form }}

<script>
    $(function () {
        var frmCommentTop = $("#frm_comment").offset().top;

        $('.btn-reply-to').on('click', function (e) {
            e.preventDefault();

            var comment = $.extend(
                {},
                {'id': 0},
                $(this).data('comment')
            );

            if (!comment.id) {
                return;
            }

            var $frm = $('form#frm_comment');

            $frm.find('#frm_comment_parent').val(comment.id);

            CKEDITOR.instances.content.setData('');

            $('html, body').animate({scrollTop: frmCommentTop});
        });
    });
</script>