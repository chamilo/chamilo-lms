{% extends "@ChamiloCore/Layout/base-layout.html.twig" %}

{% block chamilo_wrap %}

    {%- include '@ChamiloCore/Layout/vue_setup.html.twig' %}

    <section id="sectionMainContent" class="section-content">

        {%- block content %}

            <div>
                <div class="app-breadcrumb">
                    <nav class="p-breadcrumb p-component">
                        <ol class="p-breadcrumb-list">
                            <li class="p-menuitem">
                                <a href="/courses" class="p-menuitem-link">My courses</a>
                            </li>
                            /
                            <li class="p-menuitem">
                                <a href="/course/{{ courseId }}/home" class="p-menuitem-link">{{ courseName }}</a>
                            </li>
                            /
                            <li class="p-menuitem">
                                <a href="/main/user/user.php?cid={{ courseId }}" class="p-menuitem-link">Users</a>
                            </li>
                            /
                            <li class="p-menuitem">
                                <a href="/main/user/class.php?cid={{ courseId }}" class="p-menuitem-link">Classes</a>
                            </li>
                            /
                            <li class="p-menuitem">
                                {{ usergroupName }}
                            </li>
                            /
                            <li class="p-menuitem">
                                Overview
                            </li>
                        </ol>
                    </nav>
                </div>
                <a href="/main/user/class.php?cid={{ courseId }}"
                   title="{{ 'Go back to the list of classes subscribed to the course'|trans }}">
                    <i class="ch-tool-icon mdi mdi-arrow-left-bold-box" style="font-size: 32px"></i>
                </a>
                <h2>{{ 'Overview class'|trans }} : {{ usergroupName }}</h2>
            </div>

            <hr>

            {% if error is not null %}
                <div class="alert alert-danger">
                    <p>{{ error }}</p>
                </div>
            {% endif %}

            {% if warning is not null %}
                <div class="alert alert-warning">
                    <p>{{ warning }}</p>
                </div>
            {% endif %}

            {% if (usersSubscribedToCourse|length + usersNotSubscribedToCourse|length) > 0 %}
                <div style="display: flex">
                    <input style="height: 32px; width: 20vw" id="search-input" type="text"
                           placeholder="Barre de recherche">
                    <i class="ch-tool-icon mdi mdi-account-search" style="font-size: 32px"></i>
                </div>
            {% endif %}

            {% if usersSubscribedToCourse|length > 0 %}
                <div>
                    <b>{{ 'Users subscribed to this course'|trans }}</b>
                    <ul style='list-style-type: disc; padding-left: 1.5vw;'>
                        {% for user in usersSubscribedToCourse %}
                            <li class="user-display">{{ user.firstname }} {{ user.lastname }} ( {{ user.email }} )</li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}

            {% if usersNotSubscribedToCourse|length > 0 %}
                <div>
                    <b>{{ 'Users not subscribed to this course'|trans }}</b>
                    <ul style='list-style-type: disc; padding-left: 1.5vw;'>
                        {% for user in usersNotSubscribedToCourse %}
                            <li class="user-display">{{ user.firstname }} {{ user.lastname }} ( {{ user.email }} )</li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}

        {% endblock %}

    </section>

    <script>
      document.getElementById("search-input").addEventListener("input", function(e) {
        const searchTerm = e.target.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        const users = document.querySelectorAll(".user-display")

        users.forEach(user => {
          const text = user.textContent.split("(")[0].trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "")
          user.style.display = text.includes(searchTerm) ? "" : "none"
        })
      })
    </script>

{% endblock %}
