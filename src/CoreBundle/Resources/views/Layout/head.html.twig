<head>
    <meta charset="utf-8">
    <link href="https://chamilo.org/chamilo-lms/" rel="help" />
    <link href="https://chamilo.org/the-association/" rel="author" />
    <link href="https://chamilo.org/the-association/" rel="copyright" />
    <link rel="apple-touch-icon" href="{{ url('index') ~ 'apple-touch-icon.png' }}" />
    <link rel="shortcut icon" href="{{ theme_asset('images/favicon.ico') }}" type="image/x-icon" />

    {# Tracking meta settings (used for OpenGraph/Twitter and optional <title> override). #}
    {# Normalize values as strings and trim spaces to prevent rendering empty tags. #}
    {% set meta_title = chamilo_settings_get('tracking.meta_title')|default('')|trim %}
    {% set meta_description = chamilo_settings_get('tracking.meta_description')|default('')|trim %}
    {% set meta_image_path = chamilo_settings_get('tracking.meta_image_path')|default('')|trim %}
    {% set meta_twitter_site = chamilo_settings_get('tracking.meta_twitter_site')|default('')|trim %}
    {% set meta_twitter_creator = chamilo_settings_get('tracking.meta_twitter_creator')|default('')|trim %}

    {# Render OG/Twitter only if at least one relevant setting is configured. #}
    {% set has_tracking_meta = meta_title or meta_description or meta_image_path or meta_twitter_site or meta_twitter_creator %}

    <title>
        {%- block title -%}
            {# Default <title>. If tracking.meta_title is set, use it as an override. #}
            {% if meta_title %}
                {{ meta_title }}
            {% else %}
                {{ chamilo_settings_get('platform.institution') }} - {{ chamilo_settings_get('platform.site_name') }}
            {% endif %}
        {%- endblock -%}
    </title>

    {% set bug_notification_link = '' %}
    {% set help_content = '' %}
    {% set header_extra_content = header_extra_content|default(chamilo_settings_get('tracking.header_extra_content')|default(''))|trim %}
    {% set template = 'default' %}
    {% set notification_menu = '' %}
    {% set accessibility = '' %}
    {% set containerClass = '' %}
    {% set breadcrumb = '' %}
    {% set user_notifications = '' %}
    {% set message_url = '' %}
    {% set profile_link = '' %}
    {% set message_link = '' %}

    {%- block stylesheets %}
        {{ encore_entry_link_tags('legacy_free-jqgrid') }}
        {{ encore_entry_link_tags('legacy_app') }}
        {{ encore_entry_link_tags('legacy_lp') }}
        {{ encore_entry_link_tags('legacy_exercise') }}
        {{ encore_entry_link_tags('legacy_document') }}
        {{ encore_entry_link_tags('vue') }}
        {{ encore_entry_link_tags('app') }}

        {% if lp_view is defined %}
            {{ encore_entry_link_tags('css/scorm') }}
        {% endif %}

        {{ theme_asset_link_tag('colors.css') }}
        {# <link rel="stylesheet" href="theme_asset('print.css')" media="print" /> #}
    {% endblock %}

    {# --- TinyMCE shared base config (load before any TinyMCE usage) --- #}
    {{ theme_asset_script_tag('tiny-settings.js') }}

    {{ encore_entry_script_tags('legacy_free-jqgrid') }}
    {{ encore_entry_script_tags('legacy_app') }}
    {{ encore_entry_script_tags('legacy_lp') }}
    {{ encore_entry_script_tags('legacy_exercise') }}
    {{ encore_entry_script_tags('legacy_document') }}

    {# Add third party js libraries that can't be loaded using webpack #}
    {# <script src="{{ asset('libs/readmore-js/readmore.js') }}"></script> #}
    {# <script src="{{ url('index') ~ 'build/libs/js-cookie/src/js.cookie.js' }}"></script> #}

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    {# Meta description (SEO) #}
    {% if meta_description %}
        <meta name="description" content="{{ meta_description|e('html_attr') }}">
    {% endif %}

    {# OpenGraph + Twitter tags (only if configured) #}
    {% if has_tracking_meta %}
        <meta property="og:url" content="{{ absolute_url(app.request.uri) }}">
        <meta property="og:type" content="website">

        {% if meta_title %}
            <meta property="og:title" content="{{ meta_title|e('html_attr') }}">
        {% endif %}

        {% if meta_description %}
            <meta property="og:description" content="{{ meta_description|e('html_attr') }}">
        {% endif %}

        {# OG/Twitter image: prefer absolute URL #}
        {% if meta_image_path %}
            {% set meta_image_url = meta_image_path starts with 'http' ? meta_image_path : absolute_url(asset(meta_image_path)) %}
            <meta property="og:image" content="{{ meta_image_url|e('html_attr') }}">
            <meta name="twitter:image" content="{{ meta_image_url|e('html_attr') }}">
        {% endif %}

        {# Twitter/X cards: meta tags remain twitter:* #}
        {# Keep twitter:card only when tracking meta is enabled (avoid rendering unused tags). #}
        <meta name="twitter:card" content="summary_large_image">

        {% if meta_title %}
            <meta name="twitter:title" content="{{ meta_title|e('html_attr') }}">
        {% endif %}

        {% if meta_description %}
            <meta name="twitter:description" content="{{ meta_description|e('html_attr') }}">
        {% endif %}

        {% if meta_twitter_site %}
            <meta name="twitter:site" content="{{ meta_twitter_site|e('html_attr') }}">
        {% endif %}

        {% if meta_twitter_creator %}
            <meta name="twitter:creator" content="{{ meta_twitter_creator|e('html_attr') }}">
        {% endif %}
    {% endif %}

    {# Check chamilo_js key in assetic.yml #}
    {% block javascripts %}
        {% block chamilo_header_js %}
            {# Loading legacy js using the $htmlHeadXtra array #}
            {% autoescape false %}
                {% for js in legacy_javascript %}
                    {{~ js }}
                {% endfor %}
            {% endautoescape %}
        {% endblock %}
    {% endblock %}

    <link rel="manifest" href="/manifest.json">

    {# tracking.header_extra_content: inject raw HTML inside <head> #}
    {% if header_extra_content %}
        {{ header_extra_content|raw }}
    {% endif %}
</head>
